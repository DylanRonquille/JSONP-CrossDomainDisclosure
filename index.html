<!doctype html>
<html>
  <body>
    <h2>CORS Read Test</h2>
    <button id="go">Fetch</button>
    <pre id="out"></pre>

    <script>
      // Replace with the API endpoint you are authorized to test
      const TARGET = "https://138.47.13.38:8080/rest/user/whoami";

      document.getElementById("go").onclick = async () => {
        const out = document.getElementById("out");
        out.textContent = "Fetchingâ€¦";

        try {
          // Add options to include credentials for authentication if required
          const res = await fetch(TARGET, {
            credentials: "include", // Sends cookies along with the request
          });

          // Debugging CORS-related headers
          console.log("Response Headers:");
          console.log("Access-Control-Allow-Origin:", res.headers.get("access-control-allow-origin"));
          console.log("Access-Control-Allow-Credentials:", res.headers.get("access-control-allow-credentials"));

          // Check if the response was successful
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }

          // Display response status and CORS headers
          out.textContent =
            "Status: " + res.status + "\n" +
            "ACAO: " + res.headers.get("access-control-allow-origin") + "\n" +
            "ACAC: " + res.headers.get("access-control-allow-credentials") + "\n\n";

          // Display the response body
          const text = await res.text();
          out.textContent += text;

        } catch (e) {
          // Log and display detailed error information
          const errorDetails = {
            message: e.message,
            name: e.name,
            stack: e.stack,
            target: TARGET,
            timestamp: new Date().toISOString(),
          };

          console.error("Fetch Error:", errorDetails);
          out.textContent = "Blocked / Error:\n" + JSON.stringify(errorDetails, null, 2);
        }
      };
    </script>
  </body>
</html>
